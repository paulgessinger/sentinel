apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "sentinel.fullname" . }}-config
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "sentinel.labels" . | nindent 4 }}
data:
  DISKCACHE_DIR: /data
  WEBHOOK_DB_PATH: /data/webhooks.sqlite3
  OVERRIDE_LOGGING: {{ .Values.config.logLevel | quote }}
  PR_TIMEOUT: {{ .Values.config.prTimeout | quote }}
  WORKER_SLEEP: {{ .Values.config.workerSleep | quote }}
  ACCESS_TOKEN_TTL: {{ .Values.config.accessTokenTtl | quote }}
  PRS_TTL: {{ .Values.config.prsTtl | quote }}
  DRY_RUN: {{ .Values.config.dryRun | quote }}
  CHECK_RUN_DEBOUNCE_WINDOW: {{ .Values.config.checkRunDebounceWindow | quote }}
  PROCESS_START_PAUSE: {{ .Values.config.processStartPause | quote }}
  {{- if .Values.config.checkRunNameFilter }}
  CHECK_RUN_NAME_FILTER: {{ .Values.config.checkRunNameFilter | quote }}
  {{- end }}
  {{- if .Values.config.repoAllowlist }}
  REPO_ALLOWLIST: {{ .Values.config.repoAllowlist | quote }}
  {{- end }}
  WEBHOOK_DB_ENABLED: {{ .Values.config.webhookDbEnabled | quote }}
  WEBHOOK_DB_RETENTION_DAYS: {{ .Values.config.webhookDbRetentionDays | quote }}
  WEBHOOK_DB_EVENTS: {{ .Values.config.webhookDbEvents | quote }}
  WEBHOOK_DISPATCH_ENABLED: {{ .Values.config.webhookDispatchEnabled | quote }}
  WEBHOOK_PROJECTION_PRUNE_ENABLED: {{ .Values.config.webhookProjectionPruneEnabled | quote }}
  WEBHOOK_PROJECTION_COMPLETED_RETENTION_SECONDS: {{ .Values.config.webhookProjectionCompletedRetentionSeconds | quote }}
  WEBHOOK_PROJECTION_ACTIVE_RETENTION_SECONDS: {{ .Values.config.webhookProjectionActiveRetentionSeconds | quote }}
  WEBHOOK_FILTER_SELF_APP_ID: {{ .Values.config.webhookFilterSelfAppId | quote }}
  {{- if .Values.config.webhookFilterAppIds }}
  WEBHOOK_FILTER_APP_IDS: {{ .Values.config.webhookFilterAppIds | quote }}
  {{- end }}
  PROJECTION_EVAL_ENABLED: {{ .Values.config.projectionEvalEnabled | quote }}
  PROJECTION_PUBLISH_ENABLED: {{ .Values.config.projectionPublishEnabled | quote }}
  PROJECTION_DEBOUNCE_SECONDS: {{ .Values.config.projectionDebounceSeconds | quote }}
  PROJECTION_PULL_REQUEST_SYNCHRONIZE_DELAY_SECONDS: {{ .Values.config.projectionPullRequestSynchronizeDelaySeconds | quote }}
  PROJECTION_CHECK_RUN_NAME: {{ .Values.config.projectionCheckRunName | quote }}
  PROJECTION_CONFIG_CACHE_SECONDS: {{ .Values.config.projectionConfigCacheSeconds | quote }}
  PROJECTION_PR_FILES_CACHE_SECONDS: {{ .Values.config.projectionPrFilesCacheSeconds | quote }}
  PROJECTION_PATH_RULE_FALLBACK_ENABLED: {{ .Values.config.projectionPathRuleFallbackEnabled | quote }}
  {{- if .Values.telegram.enabled }}
  TELEGRAM_TOKEN: ""    # overridden by Secret env
  TELEGRAM_CHAT_ID: ""  # overridden by Secret env
  {{- end }}
